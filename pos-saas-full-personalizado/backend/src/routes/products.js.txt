export async function handleProducts(request, env) {
  const url = new URL(request.url);
  const path = url.pathname;

  if (request.method === 'GET' && path === '/api/products') {
    const results = await env.DB.prepare('SELECT * FROM products').all();
    return new Response(JSON.stringify(results), {
      headers: { 'Content-Type': 'application/json' },
    });
  }

  if (request.method === 'POST' && path === '/api/products') {
    const body = await request.json();
    const { name, price, stock, company_id } = body;

    await env.DB.prepare(
      'INSERT INTO products (name, price, stock, company_id) VALUES (?, ?, ?, ?)'
    )
      .bind(name, price, stock, company_id)
      .run();

    return new Response(JSON.stringify({ success: true }), {
      headers: { 'Content-Type': 'application/json' },
    });
  }

  return new Response('Ruta no encontrada', { status: 404 });
}